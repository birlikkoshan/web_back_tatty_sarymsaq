<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{COURSE_TITLE}}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="/enrollment.css">
</head>
<body>
    <header class="header">
        <div class="container header-inner">
            <div class="logo">StudentMS</div>
            <nav class="nav">
                    <a class="choosed-link" href="/">Home</a>
                    <a href="/about">About</a>
                    <a href="/courses">Courses</a>
                    <a href="/contact">Contact</a>
                    <a id="auth-link" href="/login">Login</a>
                    <a id="logout-link" href="#" style="display:none">Logout</a>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="course-detail">
            {{COURSE_INFO}}
        </div>
    </main>

    <footer class="footer">
        <div class="footer-container">&copy; 2025 Student Management System</div>
    </footer>

    <script>
        function enrollCourse(courseId, capacity, enrolled) {
            // Check if course is full
            if (enrolled >= capacity) {
                alert('This course is full. No more spots available.');
                return;
            }

            // Prepare update data
            const updatedData = {
                enrolled: enrolled + 1
            };

            // Send PUT request to update enrollment
            fetch(`/api/courses/${courseId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(updatedData)
            })
            .then(response => {
                if (response.status === 401) {
                    alert('Please login to enroll');
                    window.location.href = '/login';
                    return null;
                }
                if (!response.ok) {
                    throw new Error('Failed to enroll');
                }
                return response.json();
            })
            .then(data => {
                if (!data) return;
                alert('Successfully enrolled in the course!');
                // Reload page to show updated enrollment
                location.reload();
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error enrolling in course: ' + error.message);
            });
        }
    </script>
    <script src="/auth.js" defer></script>
</body>
</html>
